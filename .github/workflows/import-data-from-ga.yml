name: GA Data Importer
on:
  schedule:
    - cron: '5 9 * * *'
  push:
    branches:
      - master
      - feature/run-one-data-import-at-a-time
jobs:
  GA-Data-Importer:
    runs-on: ubuntu-latest
    environment: data_import_oaklyn
    env:
      SITE_URL: ${{ secrets.SITE_URL }}
      HASURA_API_URL: ${{ secrets.HASURA_API_URL }}
      ORG_SLUG: ${{ secrets.ORG_SLUG }}
      GOOGLE_CREDENTIALS_EMAIL: ${{ secrets.GOOGLE_CREDENTIALS_EMAIL }}
      GOOGLE_CREDENTIALS_PRIVATE_KEY: ${{ secrets.GOOGLE_CREDENTIALS_PRIVATE_KEY }}
      NEXT_PUBLIC_ANALYTICS_VIEW_ID: ${{ secrets.NEXT_PUBLIC_ANALYTICS_VIEW_ID }}
    steps:
      - run: echo "üîé Running GA data importer"
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - run: echo "üñ•Ô∏è repo and node are setup"
      - name: donate-clicks
        run: curl -f ${{env.SITE_URL}}/api/import/donate-clicks
      - name: donor-reading-frequency
        run: curl -f ${{env.SITE_URL}}/api/import/donor-reading-frequency
      - name: donors
        run: curl -f ${{env.SITE_URL}}/api/import/donors
      - name: geo-sessions
        run: curl -f ${{env.SITE_URL}}/api/import/geo-sessions
      - name: newsletter-impressions
        run: curl -f ${{env.SITE_URL}}/api/import/newsletter-impressions
      - name: newsletters
        run: curl -f ${{env.SITE_URL}}/api/import/newsletters
      - name: page-views
        run: curl -f ${{env.SITE_URL}}/api/import/page-views
      - name: reading-depth
        run: curl -f ${{env.SITE_URL}}/api/import/reading-depth
      - name: reading-frequency
        run: curl -f ${{env.SITE_URL}}/api/import/reading-frequency
      - name: referral-sessions
        run: curl -f ${{env.SITE_URL}}/api/import/referral-sessions
      - name: session-duration
        run: curl -f ${{env.SITE_URL}}/api/import/session-duration
      - name: sessions
        run: curl -f ${{env.SITE_URL}}/api/import/sessions
      - name: subscribers
        run: curl -f ${{env.SITE_URL}}/api/import/subscribers
      - run: echo "üçè This job's status is ${{ job.status }}."
